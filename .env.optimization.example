# ========================================
# 第三部分优化配置环境变量示例
# ========================================

# ========================================
# 1. MongoDB性能优化和分片策略
# ========================================

# 启用MongoDB优化
ENABLE_MONGODB_OPTIMIZATION=true

# 数据库连接池配置
DB_MIN_POOL_SIZE=5
DB_MAX_POOL_SIZE=20
DB_MAX_IDLE_TIME_MS=30000
DB_SERVER_SELECTION_TIMEOUT_MS=5000

# 查询优化配置
ENABLE_QUERY_CACHE=true
QUERY_CACHE_TTL=300
MAX_QUERY_TIME_MS=1000
ENABLE_SLOW_QUERY_LOG=true

# 索引优化配置
AUTO_CREATE_INDEXES=true
INDEX_ANALYSIS_INTERVAL_HOURS=24
UNUSED_INDEX_THRESHOLD_DAYS=30

# ========================================
# 2. 缓存策略优化和Redis集群配置
# ========================================

# 启用缓存优化
ENABLE_CACHE_OPTIMIZATION=true

# Redis集群配置
REDIS_CLUSTER_ENABLED=false
REDIS_CLUSTER_NODES=redis-node1:6379,redis-node2:6379,redis-node3:6379
REDIS_RETRY_ATTEMPTS=3
REDIS_RETRY_DELAY_MS=1000

# 缓存策略配置
DEFAULT_CACHE_TTL=3600
HOT_DATA_TTL=300
COLD_DATA_TTL=86400
ENABLE_CACHE_COMPRESSION=true
COMPRESSION_THRESHOLD=1024

# 内存缓存配置
ENABLE_MEMORY_CACHE=true
MEMORY_CACHE_MAX_SIZE_MB=100
MEMORY_CACHE_CLEANUP_INTERVAL_MS=300000

# ========================================
# 3. API安全加固和限流机制
# ========================================

# 启用安全加固
ENABLE_SECURITY_HARDENING=true

# 限流配置
ENABLE_IP_RATE_LIMIT=true
ENABLE_DEVICE_RATE_LIMIT=true
IP_REQUESTS_PER_MINUTE=100
DEVICE_REQUESTS_PER_MINUTE=60
RATE_LIMIT_WINDOW_MS=60000

# 安全头配置
ENABLE_SECURITY_HEADERS=true
ENABLE_CORS=true
ALLOWED_ORIGINS=http://localhost:3000,https://yourdomain.com

# 请求验证配置
MAX_REQUEST_SIZE_MB=10
ENABLE_DEVICE_ID_VALIDATION=true
ENABLE_SUSPICIOUS_ACTIVITY_DETECTION=true

# ========================================
# 4. MongoDB Atlas监控和告警配置
# ========================================

# 启用监控告警
ENABLE_MONITORING_ALERTS=true

# 性能监控配置
ENABLE_PERFORMANCE_MONITORING=true
METRICS_COLLECTION_INTERVAL_MS=60000
PERFORMANCE_THRESHOLD_MS=1000

# 健康检查配置
ENABLE_HEALTH_CHECK=true
HEALTH_CHECK_INTERVAL_MS=30000
HEALTH_CHECK_TIMEOUT_MS=5000

# 告警配置
ENABLE_ALERTS=true
ALERT_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
ALERT_EMAIL_RECIPIENTS=admin@yourdomain.com,dev@yourdomain.com
ALERT_COOLDOWN_MS=300000

# MongoDB Atlas API配置（用于监控）
MONGODB_ATLAS_PUBLIC_KEY=your_atlas_public_key
MONGODB_ATLAS_PRIVATE_KEY=your_atlas_private_key
MONGODB_ATLAS_PROJECT_ID=your_atlas_project_id
MONGODB_ATLAS_CLUSTER_NAME=your_cluster_name

# ========================================
# 5. 自动化备份和恢复策略
# ========================================

# 启用备份恢复
ENABLE_BACKUP_RECOVERY=true

# 备份策略配置
ENABLE_AUTO_BACKUP=true
FULL_BACKUP_INTERVAL_HOURS=24
INCREMENTAL_BACKUP_INTERVAL_HOURS=6
BACKUP_RETENTION_DAYS=30

# 备份存储配置
LOCAL_BACKUP_PATH=./backups
ENABLE_CLOUD_BACKUP=false
CLOUD_STORAGE_PROVIDER=aws-s3
CLOUD_STORAGE_BUCKET=your-backup-bucket

# AWS S3配置（如果使用云备份）
AWS_ACCESS_KEY_ID=your_aws_access_key
AWS_SECRET_ACCESS_KEY=your_aws_secret_key
AWS_REGION=us-east-1

# 恢复配置
ENABLE_AUTO_RECOVERY=false
ENABLE_RECOVERY_VERIFICATION=true
ENABLE_ROLLBACK=true

# 备份加密配置
BACKUP_ENCRYPTION_KEY=your_32_character_encryption_key_here
ENABLE_BACKUP_COMPRESSION=true

# ========================================
# 通用配置
# ========================================

# 日志级别
LOG_LEVEL=info

# 环境标识
NODE_ENV=production

# 应用端口
PORT=3000

# 数据库连接
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/database

# Redis连接
REDIS_URL=redis://localhost:6379

# JWT密钥（如果需要）
JWT_SECRET=your_jwt_secret_key_here

# API密钥（如果需要）
API_SECRET_KEY=your_api_secret_key_here

# ========================================
# 开发环境特定配置
# ========================================

# 开发模式下可以禁用某些功能以提高开发效率
# ENABLE_MONGODB_OPTIMIZATION=false
# ENABLE_CACHE_OPTIMIZATION=false
# ENABLE_SECURITY_HARDENING=false
# ENABLE_MONITORING_ALERTS=false
# ENABLE_BACKUP_RECOVERY=false

# ========================================
# 生产环境建议配置
# ========================================

# 生产环境建议启用所有优化功能
# ENABLE_MONGODB_OPTIMIZATION=true
# ENABLE_CACHE_OPTIMIZATION=true
# ENABLE_SECURITY_HARDENING=true
# ENABLE_MONITORING_ALERTS=true
# ENABLE_BACKUP_RECOVERY=true

# 生产环境建议的性能配置
# DB_MAX_POOL_SIZE=50
# MEMORY_CACHE_MAX_SIZE_MB=500
# IP_REQUESTS_PER_MINUTE=1000
# DEVICE_REQUESTS_PER_MINUTE=300

# ========================================
# 注意事项
# ========================================

# 1. 请根据实际环境调整配置值
# 2. 敏感信息（如密钥、密码）请使用安全的方式管理
# 3. 生产环境请启用所有安全功能
# 4. 定期检查和更新配置
# 5. 监控系统性能并根据需要调整参数